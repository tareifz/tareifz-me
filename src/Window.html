<div class="window" style={styles}>
    <div class="window-bar" on:windowMove="set({ })">
        <div class="window-bar-buttons">
            <div class="close">
                <svg viewBox="0 0 6.4 6.4" xmlns="http://www.w3.org/2000/svg">
                    <polygon points="6.4 0.8 5.6 0 3.2 2.4 0.8 0 0 0.8 2.4 3.2 0 5.6 0.8 6.4 3.2 4 5.6 6.4 6.4 5.6 4 3.2"
                             fill="#4d0000"/>
                </svg>
            </div>
            <div class="minimize">
                <svg viewBox="0 0 8 1.1" xmlns="http://www.w3.org/2000/svg">
                    <rect width="8" height="1.1" fill="#995700"/>
                </svg>
            </div>
            <div class="maximize">
                <svg class="fullscreen-svg" viewBox="0 0 6 5.9" xmlns="http://www.w3.org/2000/svg">
                    <path d="M5.4,0h-4L6,4.5V0.6C5.7,0.6,5.3,0.3,5.4,0z" fill="#006400"/>
                    <path d="m0.6 5.9h4l-4.6-4.5v3.9c0.3 0 0.6 0.3 0.6 0.6z" fill="#006400"/>
                </svg>
            </div>
        </div>
        <div class="window-bar-title">
            <span>{title}</span>
        </div>
    </div>
    <div class="window-content">
        Here will be the contents of the window.
    </div>
</div>

<script>
 export default {
     data() {
         return {
             top: 0,
             left: 0,
             width: 400,
             height: 300,
             title: 'about',
             close: true,
             minimize: true,
             maximize: true,
             windowBarBackgroundColor: 'white',
             windowContentBackgroundColor: '#eeeeee',
         }
     },
     events: {
         windowMove(node, callback) {
             function onMouseDown(event) {
                 let x0 = event.clientX;
                 let y0 = event.clientY;

                 let overlay = document.createElement('div');
                 document.body.appendChild(overlay);
                 overlay.style.opacity = 0.0;
                 overlay.style.height = '100%';
                 overlay.style.position = 'absolute';
                 overlay.style.width = '100%';
                 overlay.style.top = '0';
                 overlay.style.left = '0';
                 overlay.style.zIndex = '99999999';

                 function onMouseMove(event) {
                     // always move the window to the desired location
                     let dx = event.clientX - x0;
                     let dy = event.clientY - y0;
                     let {
                         innerWidth,
                         innerHeight,
                     } = window;
                     let {
                         top,
                         left,
                         width,
                         height,
                     } = this.get();

                     left += dx;
                     top += dy;
                     x0 += dx;
                     y0 += dy;

                     /* if(left >= innerWidth) {
                      *     console.log('left before: ', left)
                      *     left = innerWidth - width;
                      *     x0 = innerWidth;
                      *     console.log('left after: ', left)
                      * } */

                     this.set({
                         top,
                         left,
                     });
                 }

                 function onMouseUp() {
                     overlay.removeEventListener('mousemove', onMouseMove.bind(this), false);
                     overlay.removeEventListener('mouseup', onMouseUp, false);
                     document.body.removeChild(overlay);
                 }

                 overlay.addEventListener('mousemove', onMouseMove.bind(this), false);
                 overlay.addEventListener('mouseup', onMouseUp, false);
             }

             node.addEventListener('mousedown', onMouseDown.bind(this), false);

             return {
                 destroy() {
                     node.removeEventListener('mousedown', onMouseDown.bind(this), false);
                 }
             };
         },
     },
     computed: {
         styles: ({
             top,
             left,
             width,
             height,
         }) =>  `top: ${top}px;
                left: ${left}px;
                width: ${width}px;
                height: ${height}px;`
     }
 }

</script>

<style>
 .window {
     position: absolute;
     display: flex;
     flex-direction: column;
 }
 .window-bar {
     display: flex;
     align-items: center;
     height: 24px;
     position: relative;
     background-color: rgb(236, 234, 236);
 }
 .window-bar-buttons {
     display: flex;
     align-items: center;
     z-index: 999;
 }
 .window-bar-title {
     width: 100%;
     height: 100%;
     position: absolute;
     display: flex;
     justify-content: center;
     align-items: center;
 }
 .window-bar-title > span {
     pointer-events: none;
 }
 .close,
 .minimize,
 .maximize {
     display: inline-block;
     border-radius: 100%;
     width: 14px;
     height: 14px;
     margin: 5px 0;
     margin-left: 5px;
     line-height: 0;
 }
 .close svg,
 .minimize svg,
 .maximize svg {
     position: relative;
     width:7px;
     height: 7px;
     top: 3.5px;
     left: 3.5px;
     opacity: 0;
 }
 .window-bar-buttons:hover .close svg,
 .window-bar-buttons:hover .minimize svg,
 .window-bar-buttons:hover .maximize svg {
     opacity: 1;
 }
 .close {
     background-color: rgb(249, 125, 104);
 }
 .minimize {
     background-color: rgb(251, 200, 78);
 }
 .maximize {
     background-color: rgb(67, 191, 88);
 }
 .close:hover {
     background-color: rgb(252, 93, 69);
 }
 .minimize:hover {
     background-color: rgb(236, 162, 2);
 }
 .maximize:hover {
     background-color: rgb(16, 173, 43);
 }
 .window-content {
     height: 100%;
     background-color: whitesmoke;
     border: 1px solid rgb(236, 234, 236);
 }
</style>
